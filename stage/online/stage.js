!function(t){var e=navigator.userAgent||navigator.vendor||window.opera,n={trident:/(Trident)/i.test(e),presto:/(Presto)/i.test(e),webKit:/(AppleWebKit)/i.test(e),gecko:/(Trident)/i.test(e),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:/(Android|Linux)/i.test(e),iPhone:/(iPhone|Mac)/i.test(e),iPad:/(iPad)/i.test(e),wechat:/(MicroMessenger)/i.test(e),pc:!/(Android|iPhone|iPod|iOS|SymbianOS|Windows Phone)/i.test(e),mobile:/mobile|tablet|ip(ad|hone|od)|android/i.test(e)},a="ontouchstart"in window,r=a&&n.mobile;t.extend(t,{importScript:function(t){var e=document.createElement("script");e.setAttribute("src",t),document.getElementsByTagName("head")[0].appendChild(e)},importLink:function(t){var e=document.createElement("link");e.setAttribute("href",t),e.setAttribute("rel","stylesheet"),document.getElementsByTagName("head")[0].appendChild(e)},isEmpty:function(t){return null==t||""===t},isNotEmpty:function(t){return!this.isEmpty(t)},empty2def:function(){for(var t="",e=arguments.length,n=0;n<e;n++)if(this.isNotEmpty(arguments[n])){t=arguments[n];break}return t}}),t.extend(t.fn,{setTransition:function(e){return this.each(function(){t(this).css({"-webkit-transition":e,"-moz-transition":e,"-ms-transition":e,"-o-transition":e,transition:e})})},setTransform:function(e){return this.each(function(){t(this).css({"-webkit-transform":e,"-moz-transform":e,"-ms-transform":e,"-o-transform":e,transform:e})})},setTransformOrigin:function(e){return this.each(function(){t(this).css({"-webkit-transform-origin":e,"-moz-transform-origin":e,"-ms-transform-origin":e,"-o-transform-origin":e,"transform-origin":e})})},setAnimation:function(e){return this.each(function(){t(this).css({"-webkit-animation":e,"-moz-animation":e,"-ms-animation":e,"-o-animation":e,animation:e})})},runAnimation:function(){return this.each(function(){t(this).find("[data-animation]").each(function(e){var n=t(this);n.setAnimation(n.data("animation")).css({zIndex:e+1}).removeClass("hide")})})},clearAnimation:function(){return this.each(function(){t(this).find("[data-animation]").each(function(e){var n=t(this);n.setAnimation("").addClass("hide")})})},animationOver:function(e){return this.each(function(){var n=0,a=t(this).find("[data-animation]"),r=a.length;a.off(i).one(i,function(){n++,n>=r&&(n=0,a.off(i),t.isFunction(e)&&e())})})}});var i="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oAnimationEnd animationend",o="webkitTransitionEnd mozTransitionEnd MSTransitionEnd oTransitionEnd transitionend",s={STATUS:{INIT:"feeling",START:"started",MOVE:"turning",END:"leaving"},ANIMATION:{COVER:"cover",BLUR:"blur",ZOOM:"zoom"},DIRECTION:{V:"vertical",H:"horizontal"}},u=function(e){var n={attrs:{src:"",loop:!1,preload:"auto",autoplay:!0},callback:{onInit:null,onLoad:null,onAbort:null,onError:null,onPlay:null,onPause:null,onStop:null,onEnd:null}};this.options=t.extend(n,e||{}),this._audio=null,this._initialed=null,this._playing=null,this._loaded=null,this.run()};u.prototype={run:function(){return this._initialed?null!=this._audio:this.init()},init:function(){var e=this;try{e._audio=new Audio}catch(n){return!1}var a=e.options.attrs,r=e.options.callback;e._audio.addEventListener("loadeddata",function(){e._loaded=!0,a.autoplay&&"auto"==a.preload&&e.play(),t.isFunction(r.onLoad)&&r.onLoad.call(e)},!1),e._audio.addEventListener("abort",function(){t.isFunction(r.onAbort)&&r.onAbort.call(e)},!1),e._audio.addEventListener("error",function(){t.isFunction(r.onError)&&r.onError.call(e)},!1),e._audio.addEventListener("play",function(){e._playing=!0,t.isFunction(r.onPlay)&&r.onPlay.call(e)},!1),e._audio.addEventListener("pause",function(){e._playing=!1,t.isFunction(r.onPause)&&r.onPause.call(e)},!1),e._audio.addEventListener("ended",function(){try{e._audio.currentTime=0}catch(n){}t.isFunction(r.onEnd)&&r.onEnd.call(e)},!1);for(var i in a)i in e._audio&&(e._audio[i]=a[i]);if(a.autoplay||"auto"==a.preload)try{e._audio.load()}catch(n){}return e._initialed=!0,t.isFunction(r.onInit)&&r.onInit.call(e),!0},load:function(){this._audio.load()},toggle:function(){this._playing?this.pause():this.play()},play:function(){this._audio&&this._audio.play()},pause:function(){this._audio&&this._audio.pause()},stop:function(){if(this._audio){this._audio.pause();try{this._audio.currentTime=0}catch(t){}}}};var l={debug:!1,version:"0.0.1",simulator:{name:"动画秀",battery:"99%"},audio:{src:"",loop:!0,preload:"auto",autoplay:!0},animation:!0,mousewheel:!0,autoTurn:!1,autoTurnInterval:3e3,pauseOnAction:!0,turnAfterPaused:null,turnDuration:400,turnDistance:20,blurScale:.2,minBlur:1,turnStatus:s.STATUS.INIT,turnStartCoord:{},turnEndCoord:{},_turnPage:!1,_timer:!1,_audio:null,events:["ready","animationOver","change"],handlers:{},_autoTimer:function(){var t=this;return t._resetTimer(),t.autoTurn?(t.setDebug("auto turn timer"),t._timer=setTimeout(function(){t.nextPage()},t.autoTurnInterval)):t.turnAfterPaused&&(t.setDebug("turn after paused timer"),t._timer=setTimeout(function(){t.nextPage(),t.autoTurn=!0},t.turnAfterPaused)),t},_resetTimer:function(){var t=this;return t.setDebug("reset auto turn timer"),t._timer&&clearTimeout(t._timer),t},_clearTimer:function(){var t=this;return t.setDebug("paused auto turn timer"),t.autoTurn=!1,t._timer&&clearTimeout(t._timer),t},_setClock:function(){var e=this,n=new Date,a=n.getHours(),r=n.getMinutes();t(".phone-box .bar .time .hour").text(a<10?"0"+a:a),t(".phone-box .bar .time .minutes").text(r<10?"0"+r:r),setTimeout(function(){e._setClock()},1e3)},getTypes:function(e){var n=this;return e=t.inArray(e,n.events)==-1?e.split(" "):[e]},on:function(e,n){var a=this;return e=a.getTypes(e),t.each(e,function(e,r){if(t.inArray(r,a.events)!=-1){var i=a.handlers.hasOwnProperty(r)&&a.handlers[r];!t.isEmpty(i)&&t.isArray(i)||(i=[]),i.push(n),a.handlers[r]=i}}),a},off:function(e){var n=this;return e=n.getTypes(e),t.each(e,function(e,a){t.inArray(a,n.events)!=-1&&n.handlers.hasOwnProperty(a)&&delete n.handlers[a]}),this},trigger:function(e){var n=this;return e=n.getTypes(e),t.each(e,function(e,a){if(t.inArray(a,n.events)!=-1){var r=n.handlers.hasOwnProperty(a)&&n.handlers[a];t.isArray(r)&&t.each(r,function(e,r){t.isFunction(r)&&r.call(n,{type:a})})}}),this},startup:function(e){var a=this;t.extend(!0,a,e||{});var r=0;t(".page-current").length>0&&(r=t(".page-current").index()||0,t(".page-current").removeClass("page-current")),a.debug&&t("<div/>").addClass("debug-box").appendTo(t("body"));var o=t("<div/>").addClass("page-loading").appendTo(t("body")),s=function(){t(".phone-box").addClass("gold"),o.setAnimation("rotateOut 1s linear 1").one(i,function(){t.isNotEmpty(a.audio.src)&&(a._audio=new u({attrs:a.audio,callback:{onInit:function(){t("<div/>").addClass("audio-control off").on("touchend click",function(e){e.preventDefault(),a._audio&&(t(".audio-control").hasClass("off")?a._audio.play():a._audio.stop())}).prependTo(t(".pages")),this._playing&&t(".audio-control").removeClass("off")},onPlay:function(e){t(".audio-control").removeClass("off")},onPause:function(e){t(".audio-control").addClass("off")}}})),t(this).remove(),t(".pages").find(".page").clearAnimation(),a.onTurnPage(),t(".page").eq(r).runAnimation().addClass("page-current").animationOver(function(){a._autoTimer(),a.trigger("animationOver")}),a.trigger("ready")})};if(n.pc){var l=function(){t("html").addClass("simulator");var e=t(".pages"),n=t("<div/>").addClass("phone-box");if(n.append('<div class="top"><i></i></div>'),n.append('<div class="bar"><div class="points"><i></i><i></i><i></i><i></i><i></i></div><label class="name">'+a.simulator.name+'</label><label class="time"><span class="hour">22</span><span class="separate">:</span><span class="minutes">11</span></label><label class="percent">'+a.simulator.battery+'</label><div class="battery"><i></i></div></div>'),n.append('<div class="title">'+t.empty2def(document.title,a.simulator.name)+"</div>"),n.append(e),n.append('<div class="bottom"></div>'),t("body").append(n),a._setClock(),a.animation){var r=1200,o=r/1e3,u=o/2;n.children(".pages").setAnimation("zoomIn "+(o+u)+"s ease 0s 1 both"),n.children(".bar").setAnimation("fadeInLeft "+o+"s ease "+u+"s 1 both"),n.children(".title").setAnimation("fadeInRight "+o+"s ease "+u+"s 1 both"),n.children(".top").setAnimation("fadeInDown "+o+"s ease-out "+o+"s 1 both"),n.children(".bottom").setAnimation("fadeInUp "+o+"s ease-out "+o+"s 1 both").off(i).one(i,function(){a.setDebug("simulator startup over!"),s()})}else s()},c=[],d=c.length;d>0?t.each(c,function(t,e){a.preload({url:e,onComplete:function(t){0==--d&&l()}})}):l()}else s();return a},setDebug:function(e){var n=this;return n.debug&&(t(".debug-box").stop(!0,!0).slideDown(function(){setTimeout(function(){t(".debug-box").stop(!0).slideUp()},2e3)}).html(e),console&&console.log(e)),n},getPath:function(e){for(var n,a=document.scripts,r=a.length-1;r>=0;r--){var i=a[r].src,o=new RegExp(t.empty2def(e,"(stage\\.js[\\w\\W]*)"));if(o.test(i)){n=i.replace(RegExp.$1,"");break}}return n},preload:function(e){var n=this,a=t.empty2def(e,{});if(t.isNotEmpty(a.url)){var r=new Image;r.src=a.url;var i=a.onSuccess,o=a.onError,s=a.onComplete;r.onerror=function(){t.isFunction(o)&&o(r),t.isFunction(s)&&s(r),r=r.onload=r.onerror=null},r.onload=function(){t.isFunction(i)&&i(r),t.isFunction(s)&&s(r),r=r.onload=r.onerror=null}}else t.isFunction(a.onComplete)&&a.onComplete();return n},getPrevPage:function(){var e=t(".page").length>1?t(".page-current").prev(".page"):t(".page-current");return e.length?e:t(".page").last()},getCurrentPage:function(){return t(".page-current")},getNextPage:function(){var e=t(".page").length>1?t(".page-current").next(".page"):t(".page-current");return e.length?e:t(".page").first()},getCoord:function(e){var a={x:0,y:0};try{a=n.mobile?e.touches?{x:e.touches[0].pageX,y:e.touches[0].pageY}:{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}:{x:e.pageX,y:e.pageY};var r=t(".pages").offset()||{left:0,top:0};a.x=a.x-r.left,a.y=a.y-r.top}catch(e){a={x:0,y:0}}return a},_getPageAnimation:function(){return t(".pages").data("animation")||s.ANIMATION.COVER},_getPageDirection:function(){return t(".pages").data("direction")||s.DIRECTION.V},turnStart:function(e){var n=this;n.turnStatus=s.STATUS.START,n.turnStartCoord=n.getCoord(e),n.setDebug("start:"+n.turnStartCoord.x+","+n.turnStartCoord.y);var a=t(".page-current"),r=t(".page-active");r.removeClass("page-active").setTransform("none").setTransition("none"),a.setTransform("none").setTransition("none").setTransformOrigin("none").css({"-webkit-filter":"blur(0)"})},turnMove:function(e){var n=this;n.turnStatus=s.STATUS.MOVE,n.turnEndCoord=n.getCoord(e),n.setDebug("move:"+n.turnEndCoord.x+","+n.turnEndCoord.y);var a=n._getPageDirection()==s.DIRECTION.H,r=a?n.turnStartCoord.x-n.turnEndCoord.x:n.turnStartCoord.y-n.turnEndCoord.y,i=a?t(".pages").width():t(".pages").height(),o=i-Math.abs(r),u=o/i,l=n._getPageAnimation(),c=n.getCurrentPage();if(r>0){c.addClass("next").removeClass("prev");var d=a?"left center":"center top";if(s.ANIMATION.BLUR==l){var g=Math.max(u,n.blurScale);c.setTransform("scale("+g+")").setTransformOrigin(d).css({"-webkit-filter":"blur("+Math.max(n.minBlur,10-Math.floor(10*g))+"px)"})}else s.ANIMATION.ZOOM==l&&c.setTransform("scale("+u+")").setTransformOrigin(d);n.getNextPage().addClass("page-active").setTransform(a?"translateX("+o+"px)":"translateY("+o+"px)").siblings(".page-active").removeClass("page-active")}else if(r<0){c.addClass("prev").removeClass("next");var d=a?"right center":"center bottom";if(s.ANIMATION.BLUR==l){var g=Math.max(u,n.blurScale);c.setTransform("scale("+g+")").setTransformOrigin(d).css({"-webkit-filter":"blur("+Math.max(n.minBlur,10-Math.floor(10*g))+"px)"})}else s.ANIMATION.ZOOM==l&&c.setTransform("scale("+u+")").setTransformOrigin(d);n.getPrevPage().addClass("page-active").setTransform(a?"translateX("+-1*o+"px)":"translateY("+-1*o+"px)").siblings(".page-active").removeClass("page-active")}},turnEnd:function(){var e=this;e.turnStatus=s.STATUS.END,e.setDebug("end:"+e.turnEndCoord.x+","+e.turnEndCoord.y);var n=t(".page-current"),a=t(".page-active"),r="all "+parseFloat(e.turnDuration/1e3)+"s ease-out",i=e._getPageDirection()==s.DIRECTION.H,u=e._getPageAnimation(),l=!1,c=i?e.turnStartCoord.x-e.turnEndCoord.x:e.turnStartCoord.y-e.turnEndCoord.y;if(e._turnPage||Math.abs(c)>e.turnDistance)e.setDebug("turn page!"),e._turnPage=!1,l=!0,s.ANIMATION.BLUR==u?n.setTransition(r).setTransform("scale("+e.blurScale+")").css({"-webkit-filter":"blur("+Math.max(e.minBlur,10-Math.floor(10*this.blurScale))+"px)"}):s.ANIMATION.ZOOM==u&&n.setTransition(r).setTransform("scale(0)"),a.setTransition(r).setTransform(i?"translateX(0)":"translateY(0)");else{e.setDebug("turn reset!"),s.ANIMATION.BLUR==u?n.setTransition(r).setTransform("scale(1)").css({"-webkit-filter":"blur(0)"}):s.ANIMATION.ZOOM==u&&n.setTransition(r).setTransform("scale(1)"),a.setTransition(r);var d=i?t(".pages").width():t(".pages").height();n.hasClass("prev")?a.setTransform(i?"translateX("+-1*d+"px)":"translateY("+-1*d+"px)"):n.hasClass("next")&&a.setTransform(i?"translateX("+d+"px)":"translateY("+d+"px)")}n.removeClass("prev next"),a.off(o).one(o,function(){e.setDebug("turn page over!"),a.off(o).removeClass("page-active").setTransform("none").setTransition("none").siblings(".page-active").removeClass("page-active"),n.setTransform("none").setTransition("none").setTransformOrigin("none").css({"-webkit-filter":"blur(0)"}).siblings(".page-current").removeClass("page-current"),l&&(n.clearAnimation().removeClass("page-current"),a.addClass("page-current").runAnimation().animationOver(function(){e._autoTimer(),e.trigger("animationOver")}),e.trigger("change")),e.turnStatus=s.STATUS.INIT})},onTurnPage:function(){var e=this;if(t(".page").length>1){if(t(".pages").on(r?"touchstart":"mousedown",function(t){t.preventDefault(),e._clearTimer(),s.STATUS.INIT==e.turnStatus&&e.turnStart(t)}).on(r?"touchmove":"mousemove",function(t){t.preventDefault(),(s.STATUS.START==e.turnStatus||s.STATUS.MOVE==e.turnStatus)&&e.turnMove(t)}).on(r?"touchend touchcancel":"mouseup mouseleave",function(n){n.preventDefault(),s.STATUS.MOVE==e.turnStatus&&t(".page-active").get(0)?e.turnEnd(n):s.STATUS.END==e.turnStatus?"":e.turnStatus=s.STATUS.INIT}).on("select",function(t){t.preventDefault()}).on("scroll",function(t){t.preventDefault()}).on("mousedown mousemove","img",function(t){t.preventDefault()}),!r&&e.mousewheel){var n=0;t(".pages").on("mousewheel DOMMouseScroll",function(t){t.preventDefault();var a=(new Date).getTime();if(a-n<e.turnDuration)return!1;n=a,e._clearTimer();var r=parseInt(t.originalEvent?t.originalEvent.wheelDelta||t.originalEvent.detail:t.wheelDelta||t.detail);r>0?(e.setDebug("mouse wheel prev"),e.prevPage()):(e.setDebug("mouse wheel next"),e.nextPage())})}var a=e._getPageDirection()==s.DIRECTION.H;a?t(".page").append('<i class="u-arrow-right"><div class="pre-wrap"><div class="pre-box1"><div class="pre1"></div></div><div class="pre-box2"><div class="pre2"></div></div></div></i>'):t(".page").append('<i class="u-arrow-bottom"><div class="pre-wrap"><div class="pre-box1"><div class="pre1"></div></div><div class="pre-box2"><div class="pre2"></div></div></div></i>')}},prevPage:function(){var e=this;if(t(".page").length>1&&s.STATUS.INIT==e.turnStatus){e._resetTimer(),e._turnPage=!0,e.turnStatus=s.STATUS.END;var n=e._getPageDirection()==s.DIRECTION.H,a=e._getPageAnimation(),r=e.getCurrentPage();s.ANIMATION.BLUR!=a&&s.ANIMATION.ZOOM!=a||r.setTransform("scale(1)").setTransformOrigin(n?"right center":"center bottom");var i=n?t(".pages").width():t(".pages").height();e.getPrevPage().addClass("page-active").setTransform(n?"translateX("+-1*i+"px)":"translateY("+-1*i+"px)").siblings(".page-active").removeClass("page-active"),setTimeout(function(){e.turnEnd(),e._turnPage=!1},100)}return e},nextPage:function(){var e=this;if(t(".page").length>1&&s.STATUS.INIT==e.turnStatus){e._resetTimer(),e._turnPage=!0,e.turnStatus=s.STATUS.END;var n=e._getPageDirection()==s.DIRECTION.H,a=e._getPageAnimation(),r=e.getCurrentPage();s.ANIMATION.BLUR!=a&&s.ANIMATION.ZOOM!=a||r.setTransform("scale(1)").setTransformOrigin(n?"left center":"center top");var i=n?t(".pages").width():t(".pages").height();e.getNextPage().addClass("page-active").setTransform(n?"translateX("+i+"px)":"translateY("+i+"px)").siblings(".page-active").removeClass("page-active"),setTimeout(function(){e.turnEnd(),e._turnPage=!1},100)}return e}};t(document).ready(function(){var e=l.getPath();e&&t.importLink(e+"stage.css")}),window.STAGE={};var c=["startup","on","off","trigger","setDebug","preload","getPrevPage","getCurrentPage","getNextPage","prevPage","nextPage"];t.each(c,function(e,n){l.hasOwnProperty(n)&&(t.isFunction(l[n])?window.STAGE[n]=t.proxy(l[n],l):window.STAGE[n]=l[n])})}(window.jQuery||window.Zepto);